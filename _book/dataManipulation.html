<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 Data Manipulation in EdSurvey and Base R | Analyzing NCES Data Using EdSurvey: A User’s Guide</title>
<meta name="author" content="EdSurvey Team">
<meta name="description" content="EdSurvey gives users functions to efficiently analyze large scale education data. As mentioned in Chapter 3, EdSurvey is flexible when conducting data manipulation and preparing for survey...">
<meta name="generator" content="bookdown 0.39 with bs4_book()">
<meta property="og:title" content="Chapter 6 Data Manipulation in EdSurvey and Base R | Analyzing NCES Data Using EdSurvey: A User’s Guide">
<meta property="og:type" content="book">
<meta property="og:url" content="https://github.com/American-Institutes-for-Research/EdSurvey_A_Users_Guide/dataManipulation.html">
<meta property="og:image" content="https://github.com/American-Institutes-for-Research/EdSurvey_A_Users_Guide/images/cover.png">
<meta property="og:description" content="EdSurvey gives users functions to efficiently analyze large scale education data. As mentioned in Chapter 3, EdSurvey is flexible when conducting data manipulation and preparing for survey...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 6 Data Manipulation in EdSurvey and Base R | Analyzing NCES Data Using EdSurvey: A User’s Guide">
<meta name="twitter:description" content="EdSurvey gives users functions to efficiently analyze large scale education data. As mentioned in Chapter 3, EdSurvey is flexible when conducting data manipulation and preparing for survey...">
<meta name="twitter:image" content="https://github.com/American-Institutes-for-Research/EdSurvey_A_Users_Guide/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.8.0/transition.js"></script><script src="libs/bs3compat-0.8.0/tabs.js"></script><script src="libs/bs3compat-0.8.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Analyzing NCES Data Using EdSurvey: A User’s Guide</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled"><li><a class="" href="index.html"><span class="header-section-number">Chapter 6</span> Data Manipulation in EdSurvey and Base R</a></li></ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/American-Institutes-for-Research/EdSurvey_A_Users_Guide">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="dataManipulation" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> Data Manipulation in <code>EdSurvey</code> and Base R<a class="anchor" aria-label="anchor" href="#dataManipulation"><i class="fas fa-link"></i></a>
</h1>
<p><code>EdSurvey</code> gives users functions to efficiently analyze large scale education data. As mentioned in <a href="philosophyOfAnalysis.html#philosophyOfAnalysis">Chapter 3</a>, <code>EdSurvey</code> is flexible when conducting data manipulation and preparing for survey analysis. It allows for rudimentary data manipulation and analysis with both <code>EdSurvey</code> and base R functions to edit data before processing. Also, by calling the function <code>getData()</code>, one can extract a <code>light.edsurvey.data.frame</code> to manipulate similarly as other <code>data.frame</code> objects in other R packages. This concept is further detailed in <a href="analysisOutsideEdSurvey.html#analysisOutsideEdSurvey">Chapter 9</a>analysisOutsideEdSurvey).</p>
<div id="subsetting-the-data" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Subsetting the Data<a class="anchor" aria-label="anchor" href="#subsetting-the-data"><i class="fas fa-link"></i></a>
</h2>
<p>Analysts can directly use a subset of a dataset with <code>EdSurvey</code> functions. In this example, a summary table is created with <code>edsurveyTable</code> after filtering the sample to include only those students whose value for the <code>dsex</code> variable is male and race (as the variable <code>sdracem</code>) is either 1 or 3 (White or Hispanic). Both value levels and labels can be used in <code>EdSurvey</code> functions.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdf</span> <span class="op">&lt;-</span> <span class="fu">readNAEP</span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/data"</span>, <span class="st">"M36NT2PM.dat"</span>, package <span class="op">=</span> <span class="st">"NAEPprimer"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sdfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sdf</span>, subset <span class="op">=</span> <span class="va">dsex</span> <span class="op">==</span> <span class="st">"Male"</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">sdracem</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">|</span> <span class="va">sdracem</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">es1</span> <span class="op">&lt;-</span> <span class="fu">edsurveyTable</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">composite</span> <span class="op">~</span> <span class="va">dsex</span> <span class="op">+</span> <span class="va">sdracem</span>, data <span class="op">=</span> <span class="va">sdfm</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">es1</span></span></code></pre></div>
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<caption>
<span id="tab:table601">Table 6.1. </span>Subsetting Data </caption>
<colgroup>
<col width="7%">
<col width="13%">
<col width="7%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="left">dsex</th>
<th align="left">sdracem</th>
<th align="right">N</th>
<th align="right">WTD_N</th>
<th align="right">PCT</th>
<th align="right">SE(PCT)</th>
<th align="right">MEAN</th>
<th align="right">SE(MEAN)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Male</td>
<td align="left">White</td>
<td align="right">5160</td>
<td align="right">5035.169</td>
<td align="right">76.11329</td>
<td align="right">1.625174</td>
<td align="right">287.6603</td>
<td align="right">0.8995013</td>
</tr>
<tr class="even">
<td align="left">Male</td>
<td align="left">Hispanic</td>
<td align="right">1244</td>
<td align="right">1580.192</td>
<td align="right">23.88671</td>
<td align="right">1.625174</td>
<td align="right">260.8268</td>
<td align="right">1.5822251</td>
</tr>
</tbody>
</table></div>
</div>
<div id="recoding-variable-names-and-levels-using-recode.sdf-and-rename.sdf" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> Recoding Variable Names and Levels Using <code>recode.sdf</code> and <code>rename.sdf</code><a class="anchor" aria-label="anchor" href="#recoding-variable-names-and-levels-using-recode.sdf-and-rename.sdf"><i class="fas fa-link"></i></a>
</h2>
<p>To assist in the process of standardizing data for an <code>edsurvey.data.frame</code>, a <code>light.edsurvey.data.frame</code>, and an <code>edsurvey.data.frame.list</code>, the functions <code>recode.sdf()</code> and <code>rename.sdf()</code> are very handy.</p>
<p>The <code>recode.sdf()</code> function accepts the levels of a variable as a vector from their current values to their newly recoded value. For example, changing the lowest level of <code>b017451</code> from <code>"Never or hardly ever"</code> to <code>"Infrequently"</code> and the highest level from <code>"Every day"</code> to <code>"Frequently"</code>, will recode levels for that variable in our connection to <code>sdf</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdf2</span> <span class="op">&lt;-</span> <span class="fu">recode.sdf</span><span class="op">(</span><span class="va">sdf</span>, recode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  b017451 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Never or hardly ever"</span><span class="op">)</span>,</span>
<span>               to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Infrequently"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  b017451 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Every day"</span><span class="op">)</span>,</span>
<span>               to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span> <span class="op">(</span><span class="st">"Frequently"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">searchSDF</span><span class="op">(</span>string <span class="op">=</span> <span class="st">"b017451"</span>, data <span class="op">=</span> <span class="va">sdf2</span>, levels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>                              </span>
<span><span class="co">#&gt; Variable: b017451</span></span>
<span><span class="co">#&gt; Label: Talk about studies at home</span></span>
<span><span class="co">#&gt; Levels (Lowest level first):</span></span>
<span><span class="co">#&gt;      2. Once every few weeks</span></span>
<span><span class="co">#&gt;      3. About once a week</span></span>
<span><span class="co">#&gt;      4. 2 or 3 times a week</span></span>
<span><span class="co">#&gt;      8. Omitted</span></span>
<span><span class="co">#&gt;      0. Multiple</span></span>
<span><span class="co">#&gt;      9. Infrequently</span></span>
<span><span class="co">#&gt;      10. Frequently</span></span></code></pre></div>
<p>In addition, we can change the name of variables using <code>rename.sdf()</code>. The recoded variable <code>"b017451"</code> can be changed to a value that more effectively describes its contents, such as <code>"studytalkfrequency"</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdf2</span> <span class="op">&lt;-</span> <span class="fu">rename.sdf</span><span class="op">(</span>x <span class="op">=</span> <span class="va">sdf2</span>, oldnames <span class="op">=</span> <span class="st">"b017451"</span>, newnames <span class="op">=</span> <span class="st">"studytalkfrequency"</span><span class="op">)</span></span>
<span><span class="fu">searchSDF</span><span class="op">(</span>string <span class="op">=</span> <span class="st">"studytalkfrequency"</span>, data <span class="op">=</span> <span class="va">sdf2</span>, levels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Variable: studytalkfrequency</span></span>
<span><span class="co">#&gt; Label: Talk about studies at home</span></span>
<span><span class="co">#&gt; Levels (Lowest level first):</span></span>
<span><span class="co">#&gt;      2. Once every few weeks</span></span>
<span><span class="co">#&gt;      3. About once a week</span></span>
<span><span class="co">#&gt;      4. 2 or 3 times a week</span></span>
<span><span class="co">#&gt;      8. Omitted</span></span>
<span><span class="co">#&gt;      0. Multiple</span></span>
<span><span class="co">#&gt;      9. Infrequently</span></span>
<span><span class="co">#&gt;      10. Frequently</span></span></code></pre></div>
<p>Most <code>EdSurvey</code> analytical functions allow the user to recode variable levels through the recode argument, including, for example, <code>cor.sdf()</code>, <code>lm.sdf()</code>, and <code>edsurveyTable()</code>. Reference a function’s documentation page for details.</p>
<p>It also is important to note that <code>EdSurvey</code> functions (and function arguments) do not permanently overwrite the variable information from your data source; they recode it only for the current connection to the data in R. The original file formatting can be retrieved by reconnecting to the data source via <code>readNAEP()</code>.</p>
</div>
<div id="retrieving-data-for-further-manipulation-with-getdata-1" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Retrieving Data for Further Manipulation With <code>getData</code><a class="anchor" aria-label="anchor" href="#retrieving-data-for-further-manipulation-with-getdata-1"><i class="fas fa-link"></i></a>
</h2>
<p>Data can be extracted and manipulated using the function <code>getData</code>. The function <code>getData</code> takes an <code>edsurvey.data.frame</code> and returns a <code>light.edsurvey.data.frame</code> containing the requested variables by either specifying a set of variable names in <code>varnames</code> or entering a formula in <code>formula</code>.[^helpgetData] For plausible values and weights, only the names of the main scale/subscale and the weight variable need to be included here for all necessary supplementary variables to be automatically included.</p>
<p>To access and manipulate data for the <code>dsex</code> and <code>b017451</code> variables and the <code>num_oper</code> subject scale in <code>sdf</code>, call <code>getData</code>. In the following code, the <code>head</code> function is used, which reveals only the first few rows of the resulting data:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gddat</span> <span class="op">&lt;-</span> <span class="fu">getData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sdf</span>, varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dsex"</span>,<span class="st">"b017451"</span>, <span class="st">"num_oper"</span><span class="op">)</span>,</span>
<span>                 dropOmittedLevels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">gddat</span><span class="op">)</span></span>
<span><span class="co">#&gt;     dsex              b017451 mrps11 mrps12 mrps13 mrps14</span></span>
<span><span class="co">#&gt; 1   Male            Every day 321.57 299.37 306.94 310.63</span></span>
<span><span class="co">#&gt; 2 Female    About once a week 283.79 273.33 285.96 284.48</span></span>
<span><span class="co">#&gt; 3 Female            Every day 334.42 323.01 316.28 361.03</span></span>
<span><span class="co">#&gt; 4   Male            Every day 337.25 315.84 316.92 319.00</span></span>
<span><span class="co">#&gt; 6 Female Once every few weeks 253.99 248.50 260.63 270.22</span></span>
<span><span class="co">#&gt; 7   Male  2 or 3 times a week 313.27 329.85 315.97 313.91</span></span>
<span><span class="co">#&gt;   mrps15</span></span>
<span><span class="co">#&gt; 1 308.04</span></span>
<span><span class="co">#&gt; 2 281.61</span></span>
<span><span class="co">#&gt; 3 321.40</span></span>
<span><span class="co">#&gt; 4 323.68</span></span>
<span><span class="co">#&gt; 6 267.75</span></span>
<span><span class="co">#&gt; 7 311.69</span></span></code></pre></div>
<p>By default, setting <code>dropOmittedLevels</code> to <code>TRUE</code> removes special values such as multiple entries or instances of <code>NA</code>. <code>getData</code> tries to help by dropping the levels of factors for regression, tables, and correlations that are not typically included in analysis.</p>
</div>
<div id="retrievingAllVariablesInADataset" class="section level2" number="6.4">
<h2>
<span class="header-section-number">6.4</span> Retrieving All Variables in a Dataset<a class="anchor" aria-label="anchor" href="#retrievingAllVariablesInADataset"><i class="fas fa-link"></i></a>
</h2>
<p>To extract all data in an <code>edsurvey.data.frame</code>, define the <code>varnames</code> argument as <code>colnames(sdf)</code>, which will query all variables. Setting the arguments <code>dropOmittedLevels</code> and <code>defaultConditions</code> to <code>FALSE</code> ensures that values that would normally be removed are included:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lsdf0</span> <span class="op">&lt;-</span> <span class="fu">getData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sdf</span>, varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">sdf</span><span class="op">)</span>, addAttributes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 dropOmittedLevels <span class="op">=</span> <span class="cn">FALSE</span>, defaultConditions <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lsdf0</span><span class="op">)</span> <span class="co"># excludes the one school variable in the sdf</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sdf</span><span class="op">)</span></span></code></pre></div>
<p>Once retrieved, this dataset can be used with all <code>EdSurvey</code> functions.</p>
</div>
<div id="using-edsurvey-functions-on-a-unique-light.edsurvey.data.frame" class="section level2" number="6.5">
<h2>
<span class="header-section-number">6.5</span> Using <code>EdSurvey</code> Functions on a Unique <code>light.edsurvey.data.frame</code><a class="anchor" aria-label="anchor" href="#using-edsurvey-functions-on-a-unique-light.edsurvey.data.frame"><i class="fas fa-link"></i></a>
</h2>
<p>After manipulating the data, you can use a <code>light.edsurvey.data.frame</code> with any <code>EdSurvey</code> function. Most notably, a <code>light.edsurvey.data.frame</code> can create tables using <code>edsurveyTable</code> and run regressions with the <code>lm.sdf</code> function.</p>
<div id="edsurveytable-1" class="section level3" number="6.5.1">
<h3>
<span class="header-section-number">6.5.1</span> <code>edsurveyTable</code><a class="anchor" aria-label="anchor" href="#edsurveytable-1"><i class="fas fa-link"></i></a>
</h3>
<p>The following example creates an <code>edsurveyTable</code> using the manipulated <code>light.edsurvey.data.frame</code> (named <code>gddat</code>), the variables <code>dsex</code> and <code>b017451</code>, the five plausible values for <code>composite</code>, and the default weight <code>origwt</code>:<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Consult &lt;code&gt;?edsurveyTable&lt;/code&gt; or the vignette titled &lt;a href="https://nces.ed.gov/nationsreportcard/subject/researchcenter/pdf/using_edsurvey_for_naep.pdf"&gt;&lt;em&gt;Using EdSurvey to Analyze NCES Data: An Illustration of Analyzing NAEP Primer&lt;/em&gt;&lt;/a&gt; for details on default &lt;code&gt;edsurveyTable&lt;/code&gt; arguments.&lt;/p&gt;'><sup>1</sup></a></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gddat</span> <span class="op">&lt;-</span> <span class="fu">getData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sdf</span>, varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"composite"</span>, <span class="st">"dsex"</span>, <span class="st">"b017451"</span>,</span>
<span>                                          <span class="st">"c052601"</span>,<span class="st">"origwt"</span><span class="op">)</span>, addAttributes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">es2</span> <span class="op">&lt;-</span> <span class="fu">edsurveyTable</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">composite</span> <span class="op">~</span> <span class="va">dsex</span> <span class="op">+</span> <span class="va">b017451</span>,</span>
<span>                     weightVar <span class="op">=</span> <span class="st">"origwt"</span>, data <span class="op">=</span> <span class="va">gddat</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<caption>
<span id="tab:table602">Table 6.2. </span>Using EdSurvey Functions on a light.edsurvey.data.frame </caption>
<colgroup>
<col width="8%">
<col width="26%">
<col width="6%">
<col width="11%">
<col width="11%">
<col width="12%">
<col width="11%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">dsex</th>
<th align="left">b017451</th>
<th align="right">N</th>
<th align="right">WTD_N</th>
<th align="right">PCT</th>
<th align="right">SE(PCT)</th>
<th align="right">MEAN</th>
<th align="right">SE(MEAN)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Male</td>
<td align="left">Never or hardly ever</td>
<td align="right">2171</td>
<td align="right">2276.820</td>
<td align="right">28.99585</td>
<td align="right">0.7044670</td>
<td align="right">270.8526</td>
<td align="right">1.090086</td>
</tr>
<tr class="even">
<td align="left">Male</td>
<td align="left">Once every few weeks</td>
<td align="right">1489</td>
<td align="right">1535.884</td>
<td align="right">19.55985</td>
<td align="right">0.5538779</td>
<td align="right">275.6296</td>
<td align="right">1.357837</td>
</tr>
<tr class="odd">
<td align="left">Male</td>
<td align="left">About once a week</td>
<td align="right">1293</td>
<td align="right">1339.204</td>
<td align="right">17.05508</td>
<td align="right">0.5278360</td>
<td align="right">281.7165</td>
<td align="right">1.449683</td>
</tr>
<tr class="even">
<td align="left">Male</td>
<td align="left">2 or 3 times a week</td>
<td align="right">1424</td>
<td align="right">1454.934</td>
<td align="right">18.52893</td>
<td align="right">0.5158073</td>
<td align="right">284.7212</td>
<td align="right">1.661465</td>
</tr>
<tr class="odd">
<td align="left">Male</td>
<td align="left">Every day</td>
<td align="right">1203</td>
<td align="right">1245.385</td>
<td align="right">15.86028</td>
<td align="right">0.5824622</td>
<td align="right">277.8021</td>
<td align="right">1.929363</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">Never or hardly ever</td>
<td align="right">1383</td>
<td align="right">1425.512</td>
<td align="right">18.24810</td>
<td align="right">0.5115641</td>
<td align="right">266.7741</td>
<td align="right">1.555760</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="left">Once every few weeks</td>
<td align="right">1419</td>
<td align="right">1454.837</td>
<td align="right">18.62349</td>
<td align="right">0.5134568</td>
<td align="right">271.5970</td>
<td align="right">1.295964</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">About once a week</td>
<td align="right">1379</td>
<td align="right">1450.724</td>
<td align="right">18.57084</td>
<td align="right">0.5789385</td>
<td align="right">279.3023</td>
<td align="right">1.660139</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="left">2 or 3 times a week</td>
<td align="right">1697</td>
<td align="right">1737.825</td>
<td align="right">22.24604</td>
<td align="right">0.5070853</td>
<td align="right">282.8398</td>
<td align="right">1.459509</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">Every day</td>
<td align="right">1686</td>
<td align="right">1742.940</td>
<td align="right">22.31153</td>
<td align="right">0.6531813</td>
<td align="right">275.7997</td>
<td align="right">1.321104</td>
</tr>
</tbody>
</table></div>
</div>
<div id="lm.sdf" class="section level3" number="6.5.2">
<h3>
<span class="header-section-number">6.5.2</span> <code>lm.sdf</code><a class="anchor" aria-label="anchor" href="#lm.sdf"><i class="fas fa-link"></i></a>
</h3>
<p>To generate a linear model using a <code>light.edsurvey.data.frame</code>, the included arguments from the previous example, as well as the weight <code>origwt</code>, are passed through the <code>lm.sdf</code> function:<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Consult &lt;code&gt;?lm.sdf&lt;/code&gt; or the appendix of the vignette titled &lt;em&gt;Using EdSurvey to Analyze NCES Data: An Illustration of Analyzing NAEP Primer&lt;/em&gt; for details on default &lt;code&gt;lm.sdf&lt;/code&gt; arguments.&lt;/p&gt;"><sup>2</sup></a></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm2</span> <span class="op">&lt;-</span> <span class="fu">lm.sdf</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">composite</span> <span class="op">~</span> <span class="va">dsex</span> <span class="op">+</span> <span class="va">b017451</span>, weightVar <span class="op">=</span> <span class="st">"origwt"</span>, data <span class="op">=</span> <span class="va">gddat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">lm2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula: composite ~ dsex + b017451</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Weight variable: 'origwt'</span></span>
<span><span class="co">#&gt; Variance method: jackknife</span></span>
<span><span class="co">#&gt; JK replicates: 62</span></span>
<span><span class="co">#&gt; Plausible values: 5</span></span>
<span><span class="co">#&gt; jrrIMax: 1</span></span>
<span><span class="co">#&gt; full data n: 17606</span></span>
<span><span class="co">#&gt; n used: 15144</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                                  coef        se        t</span></span>
<span><span class="co">#&gt; (Intercept)                 270.40708   1.05390 256.5768</span></span>
<span><span class="co">#&gt; dsexFemale                   -2.92147   0.61554  -4.7462</span></span>
<span><span class="co">#&gt; b017451Once every few weeks   4.68200   1.16792   4.0088</span></span>
<span><span class="co">#&gt; b017451About once a week     11.57319   1.26477   9.1504</span></span>
<span><span class="co">#&gt; b0174512 or 3 times a week   14.88024   1.23890  12.0108</span></span>
<span><span class="co">#&gt; b017451Every day              7.93104   1.28155   6.1886</span></span>
<span><span class="co">#&gt;                                dof  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)                 51.496 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; dsexFemale                  53.963 1.565e-05 ***</span></span>
<span><span class="co">#&gt; b017451Once every few weeks 55.188 0.0001848 ***</span></span>
<span><span class="co">#&gt; b017451About once a week    49.005 3.519e-12 ***</span></span>
<span><span class="co">#&gt; b0174512 or 3 times a week  77.130 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; b017451Every day            50.501 1.074e-07 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  </span></span>
<span><span class="co">#&gt; 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple R-squared: 0.0224</span></span></code></pre></div>
<p>Contrasts from treatment groups also can be omitted from a linear model by stating the variable name in the <code>relevels</code> argument. In this example, values with <code>dsex = "Female"</code> are withheld from the regression. Use the base R function <code>summary</code> to view details about the linear model.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm3</span> <span class="op">&lt;-</span> <span class="fu">lm.sdf</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">composite</span> <span class="op">~</span> <span class="va">dsex</span> <span class="op">+</span> <span class="va">b017451</span>, data <span class="op">=</span> <span class="va">gddat</span>,</span>
<span>              relevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dsex <span class="op">=</span> <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">lm3</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula: composite ~ dsex + b017451</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Weight variable: 'origwt'</span></span>
<span><span class="co">#&gt; Variance method: jackknife</span></span>
<span><span class="co">#&gt; JK replicates: 62</span></span>
<span><span class="co">#&gt; Plausible values: 5</span></span>
<span><span class="co">#&gt; jrrIMax: 1</span></span>
<span><span class="co">#&gt; full data n: 17606</span></span>
<span><span class="co">#&gt; n used: 15144</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                                  coef        se        t</span></span>
<span><span class="co">#&gt; (Intercept)                 267.48561   1.11204 240.5350</span></span>
<span><span class="co">#&gt; dsexMale                      2.92147   0.61554   4.7462</span></span>
<span><span class="co">#&gt; b017451Once every few weeks   4.68200   1.16792   4.0088</span></span>
<span><span class="co">#&gt; b017451About once a week     11.57319   1.26477   9.1504</span></span>
<span><span class="co">#&gt; b0174512 or 3 times a week   14.88024   1.23890  12.0108</span></span>
<span><span class="co">#&gt; b017451Every day              7.93104   1.28155   6.1886</span></span>
<span><span class="co">#&gt;                                dof  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)                 65.757 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; dsexMale                    53.963 1.565e-05 ***</span></span>
<span><span class="co">#&gt; b017451Once every few weeks 55.188 0.0001848 ***</span></span>
<span><span class="co">#&gt; b017451About once a week    49.005 3.519e-12 ***</span></span>
<span><span class="co">#&gt; b0174512 or 3 times a week  77.130 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; b017451Every day            50.501 1.074e-07 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  </span></span>
<span><span class="co">#&gt; 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple R-squared: 0.0224</span></span></code></pre></div>
</div>
<div id="cor.sdf" class="section level3" number="6.5.3">
<h3>
<span class="header-section-number">6.5.3</span> cor.sdf<a class="anchor" aria-label="anchor" href="#cor.sdf"><i class="fas fa-link"></i></a>
</h3>
<p>Users might want to generate a correlation to explore a manipulated <code>light.edsurvey.data.frame</code>. The marginal correlation coefficient among plausible values of the subject scales and subscales can be calculated on a <code>light.edsurvey.data.frame</code> object <code>eddat</code> using the <code>cor.sdf</code> function and the Pearson method. In this example, the variable <code>dsex == "Female"</code> subsets our <code>light.edsurvey.data.frame</code> to calculate the correlation between the subject subscales <code>num_oper</code> and <code>algebra</code> using the default weight <code>origwt</code>:<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Consult &lt;code&gt;?cor.sdf&lt;/code&gt; or the appendix of the vignette titled &lt;em&gt;Using EdSurvey to Analyze NCES Data: An Illustration of Analyzing NAEP Primer&lt;/em&gt; for details on default &lt;code&gt;cor.sdf&lt;/code&gt; arguments.&lt;/p&gt;"><sup>3</sup></a></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eddat</span> <span class="op">&lt;-</span> <span class="fu">getData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sdf</span>, varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"num_oper"</span>,<span class="st">"algebra"</span>,<span class="st">"dsex"</span>, <span class="st">'origwt'</span><span class="op">)</span>,</span>
<span>                addAttributes <span class="op">=</span> <span class="cn">TRUE</span>, dropOmittedLevels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">eddat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">eddat</span>,<span class="va">dsex</span> <span class="op">==</span> <span class="st">"Female"</span><span class="op">)</span></span>
<span><span class="va">cor2</span> <span class="op">&lt;-</span> <span class="fu">cor.sdf</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"num_oper"</span>, y <span class="op">=</span> <span class="st">"algebra"</span>, weightVar <span class="op">=</span> <span class="st">"origwt"</span>,</span>
<span>                data <span class="op">=</span> <span class="va">eddat</span>, method <span class="op">=</span> <span class="st">"Pearson"</span><span class="op">)</span></span>
<span><span class="va">cor2</span></span>
<span><span class="co">#&gt; Method: Pearson</span></span>
<span><span class="co">#&gt; full data n: 17606</span></span>
<span><span class="co">#&gt; n used: 8429</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Correlation: 0.8917132</span></span>
<span><span class="co">#&gt; Standard Error: 0.006153243</span></span>
<span><span class="co">#&gt; Confidence Interval: [0.8785106, 0.9035547]</span></span></code></pre></div>
</div>
</div>
<div id="applying-rebindattributes-to-use-edsurvey-functions-with-manipulated-data-frames-1" class="section level2" number="6.6">
<h2>
<span class="header-section-number">6.6</span> Applying <code>rebindAttributes</code> to Use <code>EdSurvey</code> Functions With Manipulated Data Frames<a class="anchor" aria-label="anchor" href="#applying-rebindattributes-to-use-edsurvey-functions-with-manipulated-data-frames-1"><i class="fas fa-link"></i></a>
</h2>
<p>A helper function that pairs well with <code>getData</code> is <code>rebindAttributes</code>. This function allows users to reassign the attributes from a survey dataset to a data frame that might have had its attributes stripped during the manipulation process. Once attributes have been rebinded, all variables—including those outside the original dataset—are available for use in <code>EdSurvey</code> analytical functions.</p>
<p>For instance, the <code>sdf</code> object contains the following attributes:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op">(</span><span class="va">sdf</span><span class="op">)</span></span>
<span><span class="co">#&gt; $names</span></span>
<span><span class="co">#&gt;  [1] "userConditions"       "defaultConditions"   </span></span>
<span><span class="co">#&gt;  [3] "dataList"             "weights"             </span></span>
<span><span class="co">#&gt;  [5] "pvvars"               "subject"             </span></span>
<span><span class="co">#&gt;  [7] "year"                 "assessmentCode"      </span></span>
<span><span class="co">#&gt;  [9] "dataType"             "gradeLevel"          </span></span>
<span><span class="co">#&gt; [11] "achievementLevels"    "omittedLevels"       </span></span>
<span><span class="co">#&gt; [13] "survey"               "country"             </span></span>
<span><span class="co">#&gt; [15] "psuVar"               "stratumVar"          </span></span>
<span><span class="co">#&gt; [17] "jkSumMultiplier"      "recodes"             </span></span>
<span><span class="co">#&gt; [19] "dim0"                 "validateFactorLabels"</span></span>
<span><span class="co">#&gt; [21] "cacheDataLevelName"   "reqDecimalConversion"</span></span>
<span><span class="co">#&gt; [23] "fr2Path"              "dichotParamTab"      </span></span>
<span><span class="co">#&gt; [25] "polyParamTab"         "adjustedData"        </span></span>
<span><span class="co">#&gt; [27] "testData"             "scoreCard"           </span></span>
<span><span class="co">#&gt; [29] "scoreDict"            "scoreFunction"       </span></span>
<span><span class="co">#&gt; [31] "cache"               </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $class</span></span>
<span><span class="co">#&gt; [1] "edsurvey.data.frame" "edsurvey.data"</span></span></code></pre></div>
<p>These attributes are lost when variables are retrieved via <code>getData()</code>. For example, a user might want to run a linear model using <code>composite</code>, the default weight <code>origwt</code>, the variable <code>dsex</code>, and the categorical variable <code>b017451</code> recoded into a binary variable. To do so, we can return a portion of the <code>sdf</code> survey data as the <code>gddat</code> object. Next, use the base R function <code>ifelse</code> to conditionally recode the variable <code>b017451</code> by collapsing the levels <code>"Never or hardly ever"</code> and <code>"Once every few weeks"</code> into one level (<code>"Rarely"</code>) and all other levels into <code>"At least once a week"</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gddat</span> <span class="op">&lt;-</span> <span class="fu">getData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sdf</span>, varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dsex"</span>, <span class="st">"b017451"</span>, <span class="st">"origwt"</span>, <span class="st">"composite"</span><span class="op">)</span>,</span>
<span>                 dropOmittedLevels <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">gddat</span><span class="op">$</span><span class="va">studyTalk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">gddat</span><span class="op">$</span><span class="va">b017451</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Never or hardly ever"</span>,</span>
<span>                                               <span class="st">"Once every few weeks"</span><span class="op">)</span>,</span>
<span>                          <span class="st">"Rarely"</span>, <span class="st">"At least once a week"</span><span class="op">)</span></span></code></pre></div>
<p>From there, apply <code>rebindAttributes</code> from the attribute data <code>sdf</code> to the manipulated data frame <code>gddat</code>. The new variables are now available for use in <code>EdSurvey</code> analytical functions:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gddat</span> <span class="op">&lt;-</span> <span class="fu">rebindAttributes</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gddat</span>, attributeData <span class="op">=</span> <span class="va">sdf</span><span class="op">)</span></span>
<span><span class="va">lm2</span> <span class="op">&lt;-</span> <span class="fu">lm.sdf</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">composite</span> <span class="op">~</span> <span class="va">dsex</span> <span class="op">+</span> <span class="va">studyTalk</span>, data <span class="op">=</span> <span class="va">gddat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">lm2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula: composite ~ dsex + studyTalk</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Weight variable: 'origwt'</span></span>
<span><span class="co">#&gt; Variance method: jackknife</span></span>
<span><span class="co">#&gt; JK replicates: 62</span></span>
<span><span class="co">#&gt; Plausible values: 5</span></span>
<span><span class="co">#&gt; jrrIMax: 1</span></span>
<span><span class="co">#&gt; full data n: 17606</span></span>
<span><span class="co">#&gt; n used: 16331</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                      coef        se        t    dof</span></span>
<span><span class="co">#&gt; (Intercept)     281.69030   0.96690 291.3349 39.915</span></span>
<span><span class="co">#&gt; dsexFemale       -2.89797   0.59549  -4.8665 52.433</span></span>
<span><span class="co">#&gt; studyTalkRarely  -9.41418   0.79620 -11.8239 53.205</span></span>
<span><span class="co">#&gt;                  Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)     &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; dsexFemale      1.081e-05 ***</span></span>
<span><span class="co">#&gt; studyTalkRarely &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  </span></span>
<span><span class="co">#&gt; 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiple R-squared: 0.0168</span></span></code></pre></div>
<p>Additional details on the features of the <code>getData</code> function appear in the vignette titled <a href="https://www.air.org/sites/default/files/EdSurvey-getData.pdf"><em>Using the <code>getData</code> Function in EdSurvey</em></a>.</p>
</div>
<div id="important-data-manipulation-notes" class="section level2" number="6.7">
<h2>
<span class="header-section-number">6.7</span> Important Data Manipulation Notes<a class="anchor" aria-label="anchor" href="#important-data-manipulation-notes"><i class="fas fa-link"></i></a>
</h2>
<div id="memory-usage" class="section level3" number="6.7.1">
<h3>
<span class="header-section-number">6.7.1</span> Memory Usage<a class="anchor" aria-label="anchor" href="#memory-usage"><i class="fas fa-link"></i></a>
</h3>
<p>Because many NCES databases have hundreds of columns and millions of rows, <code>EdSurvey</code> allows users to analyze data without storing it in the global environment. Alternatively, the <code>getData</code> function retrieves a <code>light.edsurvey.data.frame</code> into the global environment, which can be costlier to memory usage. The base R function <code>object.size</code> estimates the memory being used to store an R object. Computations using objects stored in the global environment are markedly costlier to memory than those made directly from the <code>EdSurvey</code> database:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="va">gddat</span> <span class="op">&lt;-</span> <span class="fu">getData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sdf</span>,</span>
<span>                             varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'composite'</span>, <span class="st">'dsex'</span>, <span class="st">'b017451'</span>, <span class="st">'origwt'</span><span class="op">)</span>,</span>
<span>                             addAttributes <span class="op">=</span> <span class="cn">TRUE</span>, dropOmittedLevels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 9675824 bytes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="va">lm7</span> <span class="op">&lt;-</span> <span class="fu">lm.sdf</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">composite</span> <span class="op">~</span> <span class="va">dsex</span> <span class="op">+</span> <span class="va">b017451</span>,</span>
<span>                          weightVar<span class="op">=</span><span class="st">'origwt'</span>, data <span class="op">=</span> <span class="va">gddat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 7168568 bytes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="va">lm8</span> <span class="op">&lt;-</span> <span class="fu">lm.sdf</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">composite</span> <span class="op">~</span> <span class="va">dsex</span> <span class="op">+</span> <span class="va">b017451</span>,</span>
<span>                          weightVar<span class="op">=</span><span class="st">'origwt'</span>, data <span class="op">=</span> <span class="va">sdf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 2518768 bytes</span></span></code></pre></div>
<p>Although a manipulated <code>light.edsurvey.data.frame</code> requires nearly 10 MB of working memory to store both the <code>light.edsurvey.data.frame</code> and the regression model object (<code>lm7</code>), the resulting object of the same computation made directly from the <code>EdSurvey</code> database (<code>lm8</code>) holds only 5–7 kB. It is a good practice to remove unnecessary values saved in the global environment. Because we have stored many large data objects, let’s remove these before moving on.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">df</span>,<span class="va">gddat</span>,<span class="va">eddat</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in rm(df, gddat, eddat): object 'df' not found</span></span></code></pre></div>
<p>Some operating systems continue to hold the memory usage even after removing an object. R will clean up your global environment automatically, but a forced garbage cleanup also can be employed:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/gc.html">gc</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="forgetting-to-include-a-column-variable" class="section level3" number="6.7.2">
<h3>
<span class="header-section-number">6.7.2</span> Forgetting to Include a Column Variable<a class="anchor" aria-label="anchor" href="#forgetting-to-include-a-column-variable"><i class="fas fa-link"></i></a>
</h3>
<p>When creating a summary table or running regression, <code>EdSurvey</code> will give a warning when a column is missing:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gddat</span> <span class="op">&lt;-</span> <span class="fu">getData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sdf</span>, </span>
<span>                 varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/allnames.html">all.vars</a></span><span class="op">(</span><span class="va">composite</span> <span class="op">~</span> <span class="va">lep</span> <span class="op">+</span> <span class="va">dsex</span> <span class="op">+</span> <span class="va">iep</span><span class="op">)</span>, <span class="st">"origwt"</span><span class="op">)</span>, </span>
<span>                 addAttributes <span class="op">=</span> <span class="cn">TRUE</span>, dropOmittedLevels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">lm9</span> <span class="op">&lt;-</span> <span class="fu">lm.sdf</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">composite</span> <span class="op">~</span> <span class="va">lep</span> <span class="op">+</span> <span class="va">dsex</span> <span class="op">+</span> <span class="va">iep</span> <span class="op">+</span> <span class="va">b017451</span>, data <span class="op">=</span> <span class="va">gddat</span><span class="op">)</span></span>
<span><span class="co">## Using default weight variable 'origwt'</span></span>
<span><span class="co">## Error in getData(sdf, c(all.vars(formula), wgt), ..., includeNaLabel = TRUE)</span></span>
<span>  <span class="co">## The following variable names are required for this call </span></span>
<span>  <span class="co">## and are not on the incoming data 'b017451'.</span></span></code></pre></div>
<p>The solution is simple: Edit the call to <code>getData</code> to include the variable and rerun the linear model.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gddat</span> <span class="op">&lt;-</span> <span class="fu">getData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sdf</span>,</span>
<span>                 varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/allnames.html">all.vars</a></span><span class="op">(</span><span class="va">composite</span> <span class="op">~</span> <span class="va">lep</span> <span class="op">+</span> <span class="va">dsex</span> <span class="op">+</span> <span class="va">iep</span> <span class="op">+</span> <span class="va">b017451</span><span class="op">)</span>,<span class="st">"origwt"</span><span class="op">)</span>, </span>
<span>                 addAttributes <span class="op">=</span> <span class="cn">TRUE</span>, dropOmittedLevels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">lm9</span> <span class="op">&lt;-</span> <span class="fu">lm.sdf</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">composite</span> <span class="op">~</span> <span class="va">lep</span> <span class="op">+</span> <span class="va">dsex</span> <span class="op">+</span> <span class="va">iep</span> <span class="op">+</span> <span class="va">b017451</span>, data <span class="op">=</span> <span class="va">gddat</span><span class="op">)</span></span>
<span><span class="va">lm9</span></span>
<span><span class="co">#&gt;                 (Intercept)                       lepNo </span></span>
<span><span class="co">#&gt;                  207.356989                   35.278034 </span></span>
<span><span class="co">#&gt;                  dsexFemale                       iepNo </span></span>
<span><span class="co">#&gt;                   -5.285498                   36.170641 </span></span>
<span><span class="co">#&gt; b017451Once every few weeks    b017451About once a week </span></span>
<span><span class="co">#&gt;                    3.254744                    9.210189 </span></span>
<span><span class="co">#&gt;  b0174512 or 3 times a week            b017451Every day </span></span>
<span><span class="co">#&gt;                   12.659496                    6.808825</span></span></code></pre></div>
</div>
</div>
<div id="data-manipulation-with-tidyedsurvey" class="section level2" number="6.8">
<h2>
<span class="header-section-number">6.8</span> Data Manipulation With <code>tidyEdSurvey</code><a class="anchor" aria-label="anchor" href="#data-manipulation-with-tidyedsurvey"><i class="fas fa-link"></i></a>
</h2>
<p>EdSurvey has a companion package, <code>tidyEdSurvey</code>, designed to allow users to directly use an <code>edsurvey.data.frame</code> with common <code>dplyr</code> and <code>ggplot2</code> functions, as opposed to making a call to <code>getData</code> first. To install, run the following code within R:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"tidyEdSurvey"</span><span class="op">)</span></span></code></pre></div>
<p>Once the package is successfully installed, <code>tidyEdSurvey</code> can be loaded with the following command:</p>
<pre><code>#&gt; Warning: package 'tidyEdSurvey' was built under R version
#&gt; 4.4.1</code></pre>
<p>Anything that can be done with a standard <code>data.frame</code> object within <code>dplyr</code> and <code>ggplot2</code> can be done with an <code>edsurvey.data.frame</code> using <code>tidyEdSurvey</code>. There are two nuances to consider:</p>
<ol style="list-style-type: decimal">
<li>If the <code>select</code> verb is used on a weight variable (such as <code>origwt</code>), the default behavior will also return the jackknife replicate weights associated with that weight variable.</li>
<li>Any verb used with a plausible value variable (such as <code>algebra</code>) will return all of the associated plausible value columns (a total of 5 columns, in the case of the NAEP primer).</li>
</ol>
<div id="dplyr-with-edsurvey.data.frame" class="section level3" number="6.8.1">
<h3>
<span class="header-section-number">6.8.1</span> dplyr with <code>edsurvey.data.frame</code><a class="anchor" aria-label="anchor" href="#dplyr-with-edsurvey.data.frame"><i class="fas fa-link"></i></a>
</h3>
<p>All of the common <code>dplyr</code> verbs can be used with an <code>edsurvey.data.frame</code>, including: <code>select</code>, <code>group_by</code>, <code>filter</code>, <code>mutate</code>, <code>arrange</code>, and several more. We can consider an example where we filter to only female students, group by race, and get a count in each racial group.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdf</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">dsex</span><span class="op">==</span><span class="st">"Female"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">sdracem</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">group_size</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4977 1615 1234  384  166   53</span></span></code></pre></div>
<p>We can also utilize the <code>mutate</code> verb to create a proficiency variable based on the 1st set of plausible values.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdf2</span> <span class="op">&lt;-</span> <span class="va">sdf</span> <span class="op">%&gt;%</span>     </span>
<span>    <span class="fu">mutate</span><span class="op">(</span>prof <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>    </span>
<span>                  <span class="fu">between</span><span class="op">(</span><span class="va">mrpcm1</span>, <span class="fl">0</span>, <span class="fl">261.99</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Below Basic"</span>,   </span>
<span>                  <span class="fu">between</span><span class="op">(</span><span class="va">mrpcm1</span>, <span class="fl">262</span>, <span class="fl">298.99</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Basic"</span>,   </span>
<span>                  <span class="fu">between</span><span class="op">(</span><span class="va">mrpcm1</span>, <span class="fl">299</span>, <span class="fl">332.99</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Proficient"</span>,  </span>
<span>                  <span class="fu">between</span><span class="op">(</span><span class="va">mrpcm1</span>, <span class="fl">333</span>, <span class="fl">1e4</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Advanced"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="ggplot2-with-edsurvey.data.frame" class="section level3" number="6.8.2">
<h3>
<span class="header-section-number">6.8.2</span> ggplot2 with <code>edsurvey.data.frame</code><a class="anchor" aria-label="anchor" href="#ggplot2-with-edsurvey.data.frame"><i class="fas fa-link"></i></a>
</h3>
<p>We can use <code>ggplot2</code> independently or as part of a <code>dplyr</code> pipeline to visualize our <code>edsurvey.data.frame</code>. Using the previous example where we created a variable for proficiency, we can extend the pipeline to visualize the proportion of students at each achievement level by race.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdf2</span> <span class="op">%&gt;%</span>    </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="va">.</span>,<span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">mrpcm1</span>,fill<span class="op">=</span><span class="va">prof</span>,color<span class="op">=</span><span class="va">prof</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>      <span class="fu">facet_wrap</span><span class="op">(</span><span class="fu">vars</span><span class="op">(</span><span class="va">sdracem</span><span class="op">)</span>,scales<span class="op">=</span><span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>      <span class="fu">geom_density</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y<span class="op">=</span><span class="op">(</span><span class="va">..count..</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span><span class="op">(</span><span class="va">..count..</span>,<span class="va">..PANEL..</span>,<span class="va">sum</span><span class="op">)</span><span class="op">[</span><span class="va">..PANEL..</span><span class="op">]</span>,alpha<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span>, </span>
<span>               position<span class="op">=</span><span class="st">"stack"</span>,bw<span class="op">=</span><span class="fl">2</span>,show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#003f5c"</span>, <span class="st">"#58508d"</span>, <span class="st">"#bc5090"</span>,<span class="st">"#ff6361"</span><span class="op">)</span>,  </span>
<span>                    guide <span class="op">=</span> <span class="fu">guide_none</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu">scale_colour_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#003f5c"</span>, <span class="st">"#58508d"</span>, <span class="st">"#bc5090"</span>,<span class="st">"#ff6361"</span><span class="op">)</span>,    </span>
<span>                      guide <span class="op">=</span> <span class="fu">guide_none</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>      <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu">theme</span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, </span>
<span>            axis.title.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>, </span>
<span>            axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>    </span>
<span>      <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">262</span>,<span class="fl">299</span>,<span class="fl">333</span><span class="op">)</span>,   </span>
<span>                 color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#58508d"</span>,<span class="st">"#ff6361"</span>,<span class="st">"#003f5c"</span><span class="op">)</span>,<span class="fl">6</span><span class="op">)</span>, </span>
<span>                 linewidth<span class="op">=</span><span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>      <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>,label <span class="op">=</span> <span class="st">"Basic"</span>,x <span class="op">=</span> <span class="fl">262</span>,y <span class="op">=</span> <span class="fl">0.003</span>,angle <span class="op">=</span> <span class="fl">90</span>,vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>      <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>,label <span class="op">=</span> <span class="st">"Proficient"</span>,x <span class="op">=</span> <span class="fl">299</span>,y <span class="op">=</span> <span class="fl">0.003</span>,angle <span class="op">=</span> <span class="fl">90</span>,vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>,label <span class="op">=</span> <span class="st">"Advanced"</span>,x <span class="op">=</span> <span class="fl">333</span>,y <span class="op">=</span> <span class="fl">0.003</span>,angle <span class="op">=</span> <span class="fl">90</span>,vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> </span></code></pre></div>
<div class="inline-figure"><img src="06-data-manipulation_files/figure-html/tidyEdSurvey3-1.png" width="672"></div>

</div>
</div>
</div>

  <div class="chapter-nav">
<div class="empty"></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Analyzing NCES Data Using EdSurvey: A User’s Guide</strong>" was written by EdSurvey Team. It was last built on 2024-10-07.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
